#!/bin/sh

OPTFIND=1

TEMP=`getopt -o hs --long logo:,version:,title:,help,https,domain:,bosh:,muc:,session-auth:,chatbot: -- "$@"`
if [ $? != 0 ] ; then echo "Terminating..." >&2 ; exit 1 ; fi
eval set -- "$TEMP"

logo="img/logo.png"
protocol="http"
port=5280
title="cadence"
version=`git describe`
chatBotName=Info

while true ; do
  case "$1" in
    -h|--help)
     echo \
"Usage: ./configure
  -s, --https         automatically generate HTTPS URLs.
  --domain=DOMAIN     XMPP domain to log in on.
  --bosh=URL          BOSH URL to connect to [http://DOMAIN:5280/http-bind/]
                                          or [https://DOMAIN:5281/http-bind/]
  --muc=DOMAIN        the MUC domain to log in on. [conference.DOMAIN]
  --session-auth=URL  Optional. The URL to use for session authentication.
  --chatbot=STR       the displayed name of the virtual ChatBot [$chatBotName]
  --version=STR       the version string to be displayed [$version]
  --title=STR         the page title to be displayed [$title]
  --logo=URL          URL (can be relative) of the logo to show [$logo]"
     exit;;
    -s|--https)
      protocol="https"
      port=5281
      shift;;
    --domain)
      domain=$2;
      shift 2;;
    --bosh)
      boshURL=$2;
      shift 2;;
    --muc)
      muc=$2;
      shift 2;;
    --session-auth)
      sessionAuthURL=$2;
      shift 2;;
    --chatbot)
      chatBotName=$2
      shift 2;;
    --title)
      title=$2
      shift 2;;
    --logo)
      logo=$2
      shift 2;;
    --version)
      version=$2
      shift 2;;
    --) shift; break;;
    *) echo "Error!"; exit 1;;
  esac
done

if [ -z "$domain" ]; then
  $0 --help
  exit 1
fi

if [ -z "$boshURL" ]; then
   boshURL="$protocol://$domain:$port/http-bind/"
fi
if [ -z "$muc" ]; then
  muc="conference.$domain"
fi
echo >.config.status \
"logo=$logo
title=$title
protocol=$protocol
version=$version
xmpp.boshURL=$boshURL
xmpp.domain=$domain
xmpp.mucService=$muc
xmpp.sessionAuthURL=$sessionAuthURL
ui.chatBotName=$chatBotName"
